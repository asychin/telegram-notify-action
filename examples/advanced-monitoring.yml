name: Advanced Monitoring with Telegram

on:
  workflow_run:
    workflows: ["CI", "Build", "Deploy"]
    types: [completed, requested]
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  issues:
    types: [opened, closed]
  pull_request:
    types: [opened, closed, merged]
  release:
    types: [published]

jobs:
  monitor-workflow:
    if: github.event_name == 'workflow_run'
    runs-on: ubuntu-latest
    steps:
      - name: Workflow Success Notification
        if: github.event.workflow_run.conclusion == 'success'
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: success
          message: |
            ‚úÖ **Workflow —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω**
            
            üîÑ **Workflow:** {{workflow}}
            üìã **–ó–∞–¥–∞—á–∞:** {{job}}
            üèÉ **Runner:** {{runnerName}} –Ω–∞ {{runnerOs}}
            üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** {{runnerArch}}
            
            üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞:**
            - ID –∑–∞–ø—É—Å–∫–∞: {{runId}}
            - –ù–æ–º–µ—Ä: {{runNumber}}
            - –ü–æ–ø—ã—Ç–∫–∞: {{runAttempt}}
            - –°–æ–±—ã—Ç–∏–µ: {{eventName}}
            
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
            - –í–ª–∞–¥–µ–ª–µ—Ü: {{repositoryOwner}}
            - ID: {{repositoryId}}
            - –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞: {{refProtected}}
            
            üåê **–û–∫—Ä—É–∂–µ–Ω–∏–µ:**
            - GitHub Actions: {{actionsEnvironment}}
            - ID –æ–∫—Ä—É–∂–µ–Ω–∏—è: {{actionsEnvironmentId}}
            - Workspace: {{workspace}}
            - Temp: {{runnerTemp}}

      - name: Workflow Failure Notification
        if: github.event.workflow_run.conclusion == 'failure'
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: error
          message: |
            ‚ùå **Workflow –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π**
            
            üîÑ **Workflow:** {{workflow}}
            üìã **–ó–∞–¥–∞—á–∞:** {{job}}
            üö´ **–°—Ç–∞—Ç—É—Å:** {{jobStatus}}
            
            üîç **–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**
            - –ó–∞–ø—É—Å–∫: #{{runNumber}} (ID: {{runId}})
            - –ü–æ–ø—ã—Ç–∫–∞: {{runAttempt}}
            - SHA: {{sha}}
            - –í–µ—Ç–∫–∞: {{refName}}
            
            üë§ **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** {{actor}}
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** {{repository}}
            üîó **–°—Å—ã–ª–∫–∞:** {{serverUrl}}/{{repository}}/actions/runs/{{runId}}

  monitor-issues:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - name: New Issue Notification
        if: github.event.action == 'opened'
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: warning
          message: |
            üêõ **–ù–æ–≤—ã–π Issue**
            
            **–ê–≤—Ç–æ—Ä:** {{issueAuthor}}
            **–ó–∞–≥–æ–ª–æ–≤–æ–∫:** {{issueTitle}}
            **–ù–æ–º–µ—Ä:** #{{issueNumber}}
            **–°–æ—Å—Ç–æ—è–Ω–∏–µ:** {{issueState}}
            **–ú–µ—Ç–∫–∏:** {{labels}}
            
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** {{repository}}
            üë§ **–í–ª–∞–¥–µ–ª–µ—Ü:** {{repositoryOwner}}
            üîó **–°—Å—ã–ª–∫–∞:** {{issueUrl}}
            
            üìù **–û–ø–∏—Å–∞–Ω–∏–µ:**
            {{issueBody}}

      - name: Issue Closed Notification
        if: github.event.action == 'closed'
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: success
          message: |
            ‚úÖ **Issue –∑–∞–∫—Ä—ã—Ç**
            
            **–ó–∞–≥–æ–ª–æ–≤–æ–∫:** {{issueTitle}}
            **–ù–æ–º–µ—Ä:** #{{issueNumber}}
            **–ó–∞–∫—Ä—ã–ª:** {{actor}}
            
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** {{repository}}
            üîó **–°—Å—ã–ª–∫–∞:** {{issueUrl}}

  monitor-pr:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - name: Pull Request Notification
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: info
          message: |
            üîÑ **Pull Request {{prAction}}**
            
            **–ó–∞–≥–æ–ª–æ–≤–æ–∫:** {{prTitle}}
            **–ù–æ–º–µ—Ä:** #{{prNumber}}
            **–ê–≤—Ç–æ—Ä:** {{prAuthor}}
            **–°–æ—Å—Ç–æ—è–Ω–∏–µ:** {{prState}}
            
            üîÄ **–í–µ—Ç–∫–∏:**
            - –ò–∑: {{prHeadRef}} ({{prHeadSha}})
            - –í: {{prBaseRef}}
            
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** {{repository}}
            üë§ **–í–ª–∞–¥–µ–ª–µ—Ü:** {{repositoryOwner}}
            üîó **–°—Å—ã–ª–∫–∞:** {{prUrl}}
            
            üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
            - –ö–æ–º–º–∏—Ç—ã: {{prCommits}}
            - –ò–∑–º–µ–Ω–µ–Ω–∏—è: +{{prAdditions}} -{{prDeletions}}
            - –§–∞–π–ª–æ–≤: {{prChangedFiles}}

  scheduled-health-check:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - name: Health Check Report
        uses: asychin/telegram-notify-action@v3
        with:
          telegram_token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          chat_id: ${{ secrets.TELEGRAM_CHAT_ID }}
          template: info
          message: |
            üè• **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è**
            
            üïí **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** {{triggeredAt}}
            üè¢ **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** {{repository}}
            üë§ **–í–ª–∞–¥–µ–ª–µ—Ü:** {{repositoryOwner}}
            
            üåê **–û–∫—Ä—É–∂–µ–Ω–∏–µ GitHub Actions:**
            - –°—Ä–µ–¥–∞: {{actionsEnvironment}}
            - ID —Å—Ä–µ–¥—ã: {{actionsEnvironmentId}}
            - URL: {{actionsEnvironmentUrl}}
            
            üèÉ **Runner –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
            - –ò–º—è: {{runnerName}}
            - –û–°: {{runnerOs}}
            - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: {{runnerArch}}
            - –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞: {{workspace}}
            - –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞: {{runnerTemp}}
            
            üîó **–°—Å—ã–ª–∫–∏:**
            - –°–µ—Ä–≤–µ—Ä: {{serverUrl}}
            - API: {{apiUrl}}
            - GraphQL: {{graphqlUrl}}
            
            ‚úÖ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
